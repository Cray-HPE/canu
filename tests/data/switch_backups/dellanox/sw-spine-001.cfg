sw-spine-001 Switch Config
hostname sw-spine-001
no cli default prefix-modes enable
protocol mlag
protocol bgp
lacp
interface mlag-port-channel 1
interface mlag-port-channel 2
interface mlag-port-channel 3
interface mlag-port-channel 4
interface mlag-port-channel 5
interface mlag-port-channel 6
interface mlag-port-channel 7
interface mlag-port-channel 8
interface mlag-port-channel 9
interface mlag-port-channel 13
interface mlag-port-channel 151
interface mlag-port-channel 201
interface ethernet 1/1 mtu 9216 force
interface ethernet 1/2 mtu 9216 force
interface ethernet 1/3 mtu 9216 force
interface ethernet 1/4 mtu 9216 force
interface ethernet 1/5 mtu 9216 force
interface ethernet 1/6 mtu 9216 force
interface ethernet 1/7 mtu 9216 force
interface ethernet 1/8 mtu 9216 force
interface ethernet 1/9 mtu 9216 force
interface ethernet 1/13 mtu 9216 force
interface ethernet 1/26 mtu 9216 force
interface ethernet 1/29 mtu 9216 force
interface ethernet 1/30 mtu 9216 force
interface ethernet 1/31 speed 40G force
interface ethernet 1/32 speed 40G force
interface ethernet 1/1 speed 40G force
interface ethernet 1/2 speed 40G force
interface ethernet 1/3 speed 40G force
interface ethernet 1/4 speed 40G force
interface ethernet 1/5 speed 40G force
interface ethernet 1/6 speed 40G force
interface ethernet 1/7 speed 40G force
interface ethernet 1/8 speed 40G force
interface ethernet 1/9 speed 40G force
interface ethernet 1/13 speed 40G force
interface ethernet 1/26 speed 10G force
interface ethernet 1/29 speed 40G force
interface ethernet 1/30 speed 40G force
interface mlag-port-channel 1 mtu 9216 force
interface mlag-port-channel 2 mtu 9216 force
interface mlag-port-channel 3 mtu 9216 force
interface mlag-port-channel 4 mtu 9216 force
interface mlag-port-channel 5 mtu 9216 force
interface mlag-port-channel 6 mtu 9216 force
interface mlag-port-channel 7 mtu 9216 force
interface mlag-port-channel 8 mtu 9216 force
interface mlag-port-channel 9 mtu 9216 force
interface mlag-port-channel 13 mtu 9216 force
interface mlag-port-channel 151 mtu 9216 force
interface mlag-port-channel 201 mtu 9216 force
interface ethernet 1/1 mlag-channel-group 9 mode active
interface ethernet 1/2 mlag-channel-group 8 mode active
interface ethernet 1/3 mlag-channel-group 7 mode active
interface ethernet 1/4 mlag-channel-group 6 mode active
interface ethernet 1/5 mlag-channel-group 5 mode active
interface ethernet 1/6 mlag-channel-group 4 mode active
interface ethernet 1/7 mlag-channel-group 3 mode active
interface ethernet 1/8 mlag-channel-group 2 mode active
interface ethernet 1/9 mlag-channel-group 1 mode active
interface ethernet 1/13 mlag-channel-group 10 mode active
interface ethernet 1/26 mlag-channel-group 15 mode active
interface ethernet 1/29 mlag-channel-group 20 mode active
interface ethernet 1/30 mlag-channel-group 20 mode active
interface mlag-port-channel 1 switchport mode hybrid
interface mlag-port-channel 2 switchport mode hybrid
interface mlag-port-channel 3 switchport mode hybrid
interface mlag-port-channel 4 switchport mode hybrid
interface mlag-port-channel 5 switchport mode hybrid
interface mlag-port-channel 6 switchport mode hybrid
interface mlag-port-channel 7 switchport mode hybrid
interface mlag-port-channel 8 switchport mode hybrid
interface mlag-port-channel 9 switchport mode hybrid
interface mlag-port-channel 13 switchport mode hybrid
interface mlag-port-channel 151 switchport mode hybrid
interface mlag-port-channel 201 switchport mode hybrid
interface ethernet 1/1 description "sw-spine-001:1==>ncn-m001:pcie-slot1:1"
interface ethernet 1/2 description "sw-spine-001:2==>ncn-m002:pcie-slot1:1"
interface ethernet 1/3 description "sw-spine-001:3==>ncn-m003:pcie-slot1:1"
interface ethernet 1/4 description "sw-spine-001:4==>ncn-w001:pcie-slot1:1"
interface ethernet 1/5 description "sw-spine-001:5==>ncn-w002:pcie-slot1:1"
interface ethernet 1/6 description "sw-spine-001:6==>ncn-w003:pcie-slot1:1"
interface ethernet 1/7 description "sw-spine-001:7==>ncn-s001:pcie-slot1:1"
interface ethernet 1/8 description "sw-spine-001:8==>ncn-s002:pcie-slot1:1"
interface ethernet 1/9 description "sw-spine-001:9==>ncn-s003:pcie-slot1:1"
interface ethernet 1/13 description "sw-spine-001:13==>uan001:pcie-slot1:1"
interface ethernet 1/26 description "sw-spine-001:26==>sw-leaf-bmc-001:51"
interface ethernet 1/29 description "sw-spine-001:29==>sw-cdu-001:27"
interface ethernet 1/30 description "sw-spine-001:30==>sw-cdu-002:27"
interface ethernet 1/31 description "mlag-isl"
interface ethernet 1/32 description "mlag-isl"
interface mlag-port-channel 1 description "sw-spine-001:1==>ncn-m001:pcie-slot1:1"
interface mlag-port-channel 2 description "sw-spine-001:2==>ncn-m002:pcie-slot1:1"
interface mlag-port-channel 3 description "sw-spine-001:3==>ncn-m003:pcie-slot1:1"
interface mlag-port-channel 4 description "sw-spine-001:4==>ncn-w001:pcie-slot1:1"
interface mlag-port-channel 5 description "sw-spine-001:5==>ncn-w002:pcie-slot1:1"
interface mlag-port-channel 6 description "sw-spine-001:6==>ncn-w003:pcie-slot1:1"
interface mlag-port-channel 7 description "sw-spine-001:7==>ncn-s001:pcie-slot1:1"
interface mlag-port-channel 8 description "sw-spine-001:8==>ncn-s002:pcie-slot1:1"
interface mlag-port-channel 9 description "sw-spine-001:9==>ncn-s003:pcie-slot1:1"
interface mlag-port-channel 13 description "sw-spine-001:13==>uan001:pcie-slot1:1"
interface mlag-port-channel 151 description "sw-spine-001:26==>sw-leaf-bmc-001:51"
interface mlag-port-channel 201 description "sw-spine-001:29==>sw-cdu-001:27"
interface mlag-port-channel 201 description "sw-spine-001:30==>sw-cdu-002:27"
banner motd "
###############################################################################
# CSM version:  1.0
# CANU version: 1.2.0~develop
###############################################################################
"
interface port-channel 256
interface ethernet 1/31 channel-group 99 mode active
interface ethernet 1/32 channel-group 99 mode active
interface port-channel 256 description "mlag-isl"
interface port-channel 256 dcb priority-flow-control mode on force
interface mlag-port-channel 1 no shutdown
interface mlag-port-channel 2 no shutdown
interface mlag-port-channel 3 no shutdown
interface mlag-port-channel 4 no shutdown
interface mlag-port-channel 5 no shutdown
interface mlag-port-channel 6 no shutdown
interface mlag-port-channel 7 no shutdown
interface mlag-port-channel 8 no shutdown
interface mlag-port-channel 9 no shutdown
interface mlag-port-channel 13 no shutdown
interface mlag-port-channel 151 no shutdown
interface mlag-port-channel 201 no shutdown
interface mlag-port-channel 1 lacp-individual enable force
interface mlag-port-channel 2 lacp-individual enable force
interface mlag-port-channel 3 lacp-individual enable force
interface mlag-port-channel 4 lacp-individual enable force
interface mlag-port-channel 5 lacp-individual enable force
interface mlag-port-channel 6 lacp-individual enable force
interface mlag-port-channel 7 lacp-individual enable force
interface mlag-port-channel 8 lacp-individual enable force
interface mlag-port-channel 9 lacp-individual enable force
interface mlag-port-channel 13 lacp-individual enable force
vlan 2
vlan 4
vlan 7
vlan 4000
vlan 2 name "RVR_NMN"
vlan 4 name "RVR_HMN"
vlan 7 name "CAN"
vlan 4000 name "MLAG"
interface mlag-port-channel 1 switchport hybrid allowed-vlan add 2
interface mlag-port-channel 1 switchport hybrid allowed-vlan add 4
interface mlag-port-channel 1 switchport hybrid allowed-vlan add 7
interface mlag-port-channel 2 switchport hybrid allowed-vlan add 2
interface mlag-port-channel 2 switchport hybrid allowed-vlan add 4
interface mlag-port-channel 2 switchport hybrid allowed-vlan add 7
interface mlag-port-channel 3 switchport hybrid allowed-vlan add 2
interface mlag-port-channel 3 switchport hybrid allowed-vlan add 4
interface mlag-port-channel 3 switchport hybrid allowed-vlan add 7
interface mlag-port-channel 4 switchport hybrid allowed-vlan add 2
interface mlag-port-channel 4 switchport hybrid allowed-vlan add 4
interface mlag-port-channel 4 switchport hybrid allowed-vlan add 7
interface mlag-port-channel 5 switchport hybrid allowed-vlan add 2
interface mlag-port-channel 5 switchport hybrid allowed-vlan add 4
interface mlag-port-channel 5 switchport hybrid allowed-vlan add 7
interface mlag-port-channel 6 switchport hybrid allowed-vlan add 2
interface mlag-port-channel 6 switchport hybrid allowed-vlan add 4
interface mlag-port-channel 6 switchport hybrid allowed-vlan add 7
interface mlag-port-channel 7 switchport hybrid allowed-vlan add 2
interface mlag-port-channel 7 switchport hybrid allowed-vlan add 4
interface mlag-port-channel 7 switchport hybrid allowed-vlan add 7
interface mlag-port-channel 8 switchport hybrid allowed-vlan add 2
interface mlag-port-channel 8 switchport hybrid allowed-vlan add 4
interface mlag-port-channel 8 switchport hybrid allowed-vlan add 7
interface mlag-port-channel 9 switchport hybrid allowed-vlan add 2
interface mlag-port-channel 9 switchport hybrid allowed-vlan add 4
interface mlag-port-channel 9 switchport hybrid allowed-vlan add 7
interface mlag-port-channel 13 switchport hybrid allowed-vlan add 2
interface mlag-port-channel 13 switchport hybrid allowed-vlan add 4
interface mlag-port-channel 151 switchport hybrid allowed-vlan add 2
interface mlag-port-channel 151 switchport hybrid allowed-vlan add 4
interface mlag-port-channel 201 switchport hybrid allowed-vlan add 2
interface mlag-port-channel 201 switchport hybrid allowed-vlan add 4
web vrf default enable force
ip routing vrf default
ip name-server vrf vrf-default 10.92.100.225
interface loopback 0
interface loopback 0 ip address 10.2.0.2/32 primary
interface vlan 1
interface vlan 2
interface vlan 4
interface vlan 7
interface vlan 10
interface vlan 4000
interface vlan 1 ip address 192.168.1.2/16 primary
interface vlan 2 ip address 192.168.3.2/17 primary
interface vlan 4 ip address 192.168.0.2/17 primary
interface vlan 7 ip address 192.168.11.2/24 primary
interface vlan 4000 ip address 192.168.255.253/30 primary
no interface vlan 1 ip icmp redirect
interface vlan 1 mtu 9184
no interface vlan 2 ip icmp redirect
interface vlan 2 mtu 9184
no interface vlan 4 ip icmp redirect
interface vlan 4 mtu 9184
no interface vlan 7 ip icmp redirect
interface vlan 7 mtu 9184
interface vlan 4000 mtu 9216
ip load-sharing source-ip-port
ip load-sharing type consistent
spanning-tree mode mst
spanning-tree priority 4096
spanning-tree port type edge default
spanning-tree mst name cray
spanning-tree mst revision 2
interface mlag-port-channel 151 spanning-tree port type network
interface mlag-port-channel 151 spanning-tree guard root
interface mlag-port-channel 201 spanning-tree port type network
interface mlag-port-channel 201 spanning-tree guard root
ipv4 access-list nmn-hmn
ipv4 access-list nmn-hmn bind-point rif
ipv4 access-list nmn-hmn seq-number 10 deny ip 192.168.3.0 mask 255.255.128.0 192.168.0.0 mask 255.255.128.0
ipv4 access-list nmn-hmn seq-number 20 deny ip 192.168.0.0 mask 255.255.128.0 192.168.3.0 mask 255.255.128.0
ipv4 access-list nmn-hmn seq-number 30 deny ip 192.168.3.0 mask 255.255.128.0 192.168.200.0 mask 255.255.128.0
ipv4 access-list nmn-hmn seq-number 40 deny ip 192.168.0.0 mask 255.255.128.0 192.168.100.0 mask 255.255.128.0
ipv4 access-list nmn-hmn seq-number 50 deny ip 192.168.100.0 mask 255.255.128.0 192.168.0.0 mask 255.255.128.0
ipv4 access-list nmn-hmn seq-number 60 deny ip 192.168.100.0 mask 255.255.128.0 192.168.200.0 mask 255.255.128.0
ipv4 access-list nmn-hmn seq-number 70 deny ip 192.168.200.0 mask 255.255.128.0 192.168.3.0 mask 255.255.128.0
ipv4 access-list nmn-hmn seq-number 80 deny ip 192.168.200.0 mask 255.255.128.0 192.168.100.0 mask 255.255.128.0
ipv4 access-list nmn-hmn seq-number 90 permit ip any any
interface vlan 2 ipv4 port access-group nmn-hmn
interface vlan 4 ipv4 port access-group nmn-hmn
protocol ospf
router ospf 1 vrf default
router ospf 1 vrf default router-id 10.2.0.2
interface loopback 0 ip ospf area 0.0.0.0
interface vlan 2 ip ospf area 0.0.0.0
interface vlan 4 ip ospf area 0.0.0.0
router ospf 1 vrf default redistribute bgp
ip dhcp relay instance 2 vrf default
ip dhcp relay instance 4 vrf default
ip dhcp relay instance 2 address 10.92.100.222
ip dhcp relay instance 4 address 10.94.100.222
interface vlan 1 ip dhcp relay instance 2 downstream
interface vlan 2 ip dhcp relay instance 2 downstream
interface vlan 4 ip dhcp relay instance 4 downstream
interface vlan 7 ip dhcp relay instance 2 downstream
protocol magp
interface vlan 1 magp 1
interface vlan 2 magp 2
interface vlan 4 magp 3
interface vlan 7 magp 4
interface vlan 1 magp 1 ip virtual-router address 192.168.1.1
interface vlan 2 magp 2 ip virtual-router address 192.168.3.1
interface vlan 4 magp 3 ip virtual-router address 192.168.0.1
interface vlan 7 magp 4 ip virtual-router address 192.168.11.1
interface vlan 1 magp 1 ip virtual-router mac-address 00:00:5E:00:01:01
interface vlan 2 magp 2 ip virtual-router mac-address 00:00:5E:00:01:02
interface vlan 4 magp 3 ip virtual-router mac-address 00:00:5E:00:01:03
interface vlan 7 magp 4 ip virtual-router mac-address 00:00:5E:00:01:04
mlag-vip mlag-domain ip 192.168.255.242 /29 force
no mlag shutdown
mlag system-mac 00:00:5E:00:01:01
interface port-channel 256 ipl 1
interface vlan 4000 ipl 1 peer-address 192.168.255.254
no interface mgmt0 dhcp
interface mgmt0 ip address 192.168.255.241 /29
ip prefix-list pl-can
ip prefix-list pl-can seq 10 permit 192.168.11.0 /24 ge 24
ip prefix-list pl-hmn
ip prefix-list pl-hmn seq 20 permit 10.94.100.0 /24 ge 24
ip prefix-list pl-nmn
ip prefix-list pl-nmn seq 30 permit 10.92.100.0 /24 ge 24
route-map ncn-w001 permit 10 match ip address pl-can
route-map ncn-w001 permit 10 set ip next-hop 192.168.11.4
route-map ncn-w001 permit 20 match ip address pl-hmn
route-map ncn-w001 permit 20 set ip next-hop 192.168.0.4
route-map ncn-w001 permit 30 match ip address pl-nmn
route-map ncn-w001 permit 30 set ip next-hop 192.168.4.4
route-map ncn-w002 permit 10 match ip address pl-can
route-map ncn-w002 permit 10 set ip next-hop 192.168.11.5
route-map ncn-w002 permit 20 match ip address pl-hmn
route-map ncn-w002 permit 20 set ip next-hop 192.168.0.5
route-map ncn-w002 permit 30 match ip address pl-nmn
route-map ncn-w002 permit 30 set ip next-hop 192.168.4.5
route-map ncn-w003 permit 10 match ip address pl-can
route-map ncn-w003 permit 10 set ip next-hop 192.168.11.6
route-map ncn-w003 permit 20 match ip address pl-hmn
route-map ncn-w003 permit 20 set ip next-hop 192.168.0.6
route-map ncn-w003 permit 30 match ip address pl-nmn
route-map ncn-w003 permit 30 set ip next-hop 192.168.4.6
router bgp 65533 vrf default
router bgp 65533 vrf default router-id 10.2.0.2 force
router bgp 65533 vrf default distance 20 70 20
router bgp 65533 vrf default maximum-paths ibgp 32
router bgp 65533 vrf default neighbor 192.168.4.4 remote-as 65533
router bgp 65533 vrf default neighbor 192.168.4.4 route-map ncn-w001
router bgp 65533 vrf default neighbor 192.168.4.5 remote-as 65533
router bgp 65533 vrf default neighbor 192.168.4.5 route-map ncn-w002
router bgp 65533 vrf default neighbor 192.168.4.6 remote-as 65533
router bgp 65533 vrf default neighbor 192.168.4.6 route-map ncn-w003
router bgp 65533 vrf default neighbor 192.168.4.4 timers 1 3
router bgp 65533 vrf default neighbor 192.168.4.5 timers 1 3
router bgp 65533 vrf default neighbor 192.168.4.6 timers 1 3
router bgp 65533 vrf default neighbor 192.168.4.4 transport connection-mode passive
router bgp 65533 vrf default neighbor 192.168.4.5 transport connection-mode passive
router bgp 65533 vrf default neighbor 192.168.4.6 transport connection-mode passive
no ntp server 192.168.4.4 disable
ntp server 192.168.4.4 keyID 0
no ntp server 192.168.4.4 trusted-enable
ntp server 192.168.4.4 version 4
no ntp server 192.168.4.5 disable
ntp server 192.168.4.5 keyID 0
no ntp server 192.168.4.5 trusted-enable
ntp server 192.168.4.5 version 4
no ntp server 192.168.4.6 disable
ntp server 192.168.4.6 keyID 0
no ntp server 192.168.4.6 trusted-enable
ntp server 192.168.4.6 version 4
ntp vrf default enable