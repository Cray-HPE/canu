{#- sw-leaf-bmc #}
{%- include '1.3/aruba/common/unknown.j2' %}
hostname {{ variables.HOSTNAME }}
{%- include '1.3/aruba/common/banner-motd.j2' %}
no ip icmp redirect
vrf Customer
ntp server {{ variables.NCN_W001 }}
ntp server {{ variables.NCN_W002 }}
ntp server {{ variables.NCN_W003 }}
ntp enable



ssh server vrf default
ssh server vrf mgmt
ssh server vrf Customer
{%- include '1.3/aruba/common/acl.j2' %}

vlan {{ variables.NATIVE_VLAN }}
vlan {{ variables.NMN_VLAN }}
    name NMN
    apply access-list ip nmn-hmn in
    apply access-list ip nmn-hmn out
vlan {{ variables.HMN_VLAN }}
    name HMN
    apply access-list ip nmn-hmn in
    apply access-list ip nmn-hmn out
vlan {{ variables.CMN_VLAN }}
    name CMN

spanning-tree
{#- forward delay added to help with pxe boots. CASMNET-1099 + CASMTRIAGE-2793 #}
spanning-tree forward-delay 4
spanning-tree config-name MST0
spanning-tree config-revision 1
interface mgmt
    shutdown
    ip dhcp
{%- include '1.3/aruba/common/qos.j2' %}

{% include '1.3/aruba/common/compute.j2' %}
{% include '1.3/aruba/common/bmc.j2' %}
{% include '1.3/aruba/full/leaf-bmc-to-leaf.lag.j2' %}
{% include '1.3/aruba/common/leaf_bmc_unused_port.j2' %}

interface loopback 0 {% set loopback_number = 0 %} 
    description default VRF loopback
    ip address {{ loopback_ipv4(variables.HOSTNAME, loopback_number) }}/32
    ipv6 address {{ loopback_ipv6(variables.HOSTNAME, loopback_number) }}/128
    ip ospf 1 area 0.0.0.0
    ipv6 ospfv3 1 area 0.0.0.0
    ip pim-sparse enable
    ipv6 pim6-sparse enable
interface loopback 1 {% set loopback_number = 1 %} 
    description Customer VRF loopback
    ip address {{ loopback_ipv4(variables.HOSTNAME, loopback_number) }}/32
    ipv6 address {{ loopback_ipv6(variables.HOSTNAME, loopback_number) }}/128
    ip ospf 2 area 0.0.0.0
    ipv6 ospfv3 2 area 0.0.0.0
interface vlan {{ variables.NATIVE_VLAN }}
    ip mtu 9198
    ip address {{ variables.MTL_IP }}/{{variables.MTL_PREFIX_LEN}}
    {#- Needs variable defined in https://jira-pro.its.hpecorp.net:8443/browse/CASMNET-1665
    ipv6 address {{ variables.MTL_IPv6 }}/{{variables.MTL_PREFIX_LEN_IPv6}}
    #}
    ip ospf 1 area 0.0.0.0
    ip ospf passive
    ipv6 ospfv3 1 area 0.0.0.0
    ipv6 ospfv3 passive
    ip igmp enable
    ipv6 mld enable
interface vlan {{ variables.NMN_VLAN }}
    description NMN
    ip mtu 9198
    ip address {{ variables.NMN_IP }}/{{variables.NMN_PREFIX_LEN}}
    {#- Needs variable defined in https://jira-pro.its.hpecorp.net:8443/browse/CASMNET-1665
    ipv6 address {{ variables.NMN_IPv6 }}/{{variables.NMN_PREFIX_LEN_IPv6}}
    #}
    ip ospf 1 area 0.0.0.0
    ipv6 ospfv3 1 area 0.0.0.0
    ip igmp enable
    ipv6 mld enable
interface vlan {{ variables.HMN_VLAN }}
    description HMN
    ip mtu 9198
    ip address {{ variables.HMN_IP }}/{{variables.HMN_PREFIX_LEN}}
    {#- Needs variable defined in https://jira-pro.its.hpecorp.net:8443/browse/CASMNET-1665
    ipv6 address {{ variables.HMN_IPv6 }}/{{variables.HMN_PREFIX_LEN_IPv6}}
    #}
    ip ospf 1 area 0.0.0.0
    ip ospf passive
    ipv6 ospfv3 1 area 0.0.0.0
    ipv6 ospfv3 passive
    ip igmp enable
    ipv6 mld enable
interface vlan {{ variables.CMN_VLAN }}
    vrf attach Customer
    description CMN
    ip mtu 9198
    ip address {{ variables.CMN_IP }}/{{variables.CMN_PREFIX_LEN}}
    {#- Needs variable defined in https://jira-pro.its.hpecorp.net:8443/browse/CASMNET-1665
    ipv6 address {{ variables.CMN_IPv6 }}/{{variables.CMN_PREFIX_LEN_IPv6}}
    #}
    ip ospf 2 area 0.0.0.0
    ipv6 ospfv3 2 area 0.0.0.0
    ip igmp enable
    ipv6 mld enable
snmp-server vrf default
ip dns server-address {{ variables.NMNLB_DNS }}
router ospf 2 vrf Customer
    router-id {{ variables.LOOPBACK_IP }}
    area 0.0.0.0
router ospfv3 2 vrf Customer
    router-id {{ variables.LOOPBACK_IP }}
    area 0.0.0.0
router ospf 1
    router-id {{ variables.LOOPBACK_IP }}
    area 0.0.0.0
router ospfv3 1
    router-id {{ variables.LOOPBACK_IP }}
    area 0.0.0.0
https-server vrf Customer
https-server vrf default
https-server vrf mgmt
{# end sw-leaf-bmc #}