
{#- leaf-to-spine.lag #}
{%- set ns = namespace(lag1='') %}
{%- for node in cabling.nodes if node.subtype == "spine" %}
{#- Use the namespace to set the first of the two connections from the leaf to a single spine
They need to be on a single lag
Two Separate interfaces e.g. (1/1/53, 1/1/54) #}
{%- if ns.lag1 == '' %}
{%- set ns.lag1 = node.config.LAG_NUMBER %}

interface mlag-port-channel {{ node.config.LAG_NUMBER }}
interface mlag-port-channel {{ node.config.LAG_NUMBER }}  mtu 9216 force
interface mlag-port-channel {{ node.config.LAG_NUMBER }}  switchport mode hybrid
interface mlag-port-channel {{ node.config.LAG_NUMBER }}  lacp-individual enable force
interface mlag-port-channel {{ node.config.LAG_NUMBER }}  switchport hybrid allowed-vlan add {{ variables.NMN_VLAN }}
interface mlag-port-channel {{ node.config.LAG_NUMBER }}  switchport hybrid allowed-vlan add {{ variables.HMN_VLAN }}
interface mlag-port-channel {{ node.config.LAG_NUMBER }}  switchport hybrid allowed-vlan add {{ variables.CAN_VLAN }}
interface mlag-port-channel {{ node.config.LAG_NUMBER }}  switchport hybrid allowed-vlan add 10

{%- endif %}
{%- endfor %}

{%- for node in cabling.nodes if node.subtype == "spine"%}

interface ethernet {{ node.config.PORT }} mlag-channel-group {{ node.config.LAG_NUMBER }} mode active
interface mlag-port-channel {{ node.config.PORT }} description {{ node.config.DESCRIPTION }}

{%- endfor %}
{#- end leaf-to-spine.lag #}%


