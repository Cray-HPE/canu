{#- sw-cdu.secondary #}
{%- include '1.2/aruba/common/unknown.j2' %}
hostname {{ variables.HOSTNAME }}
{%- include '1.2/aruba/common/banner-motd.j2' %}
no ip icmp redirect
vrf keepalive
vrf Customer
ntp server {{ variables.NCN_W001 }}
ntp server {{ variables.NCN_W002 }}
ntp server {{ variables.NCN_W003 }}
ntp enable



ssh server vrf Customer
ssh server vrf default
ssh server vrf keepalive
ssh server vrf mgmt
{%- include '1.2/aruba/common/acl.j2' %}

vlan {{ variables.NATIVE_VLAN }}
vlan {{ variables.NMN_VLAN }}
    name NMN
    apply access-list ip nmn-hmn in
    apply access-list ip nmn-hmn out
vlan {{ variables.HMN_VLAN }}
    name HMN
    apply access-list ip nmn-hmn in
    apply access-list ip nmn-hmn out
vlan {{ variables.CMN_VLAN }}
    name CMN
spanning-tree
{#- forward delay added to help with pxe boots. CASMNET-1099 + CASMTRIAGE-2793 #}
spanning-tree forward-delay 4
spanning-tree config-name MST0
spanning-tree config-revision 1
interface mgmt
    shutdown
    ip dhcp

{% include '1.2/aruba/common/cmm.j2' %}
{% include '1.2/aruba/common/cec.j2' %}
{% include '1.2/aruba/common/cdu-to-spine.lag.j2' %}

interface lag 256
    no shutdown
    description ISL link
    no routing
    vlan trunk native 1 tag
    vlan trunk allowed all
    lacp mode active

interface 1/1/{{ variables.VSX_KEEPALIVE }}
    no shutdown
    mtu 9198
    vrf attach keepalive
    description vsx keepalive
    ip address 192.168.255.1/31

interface 1/1/{{ variables.VSX_ISL_PORT1 }}
    no shutdown
    mtu 9198
    description vsx isl
    lag 256

interface 1/1/{{ variables.VSX_ISL_PORT2 }}
    no shutdown
    mtu 9198
    description vsx isl
    lag 256

interface loopback 0
    ip address {{ variables.LOOPBACK_IP }}/32
    ip ospf 1 area 0.0.0.0
interface vlan 1
    ip mtu 9198
    ip address {{ variables.MTL_IP }}/{{variables.MTL_PREFIX_LEN}}
interface vlan {{ variables.NMN_VLAN }}
    description NMN
    ip mtu 9198
    ip address {{ variables.NMN_IP }}/{{variables.NMN_PREFIX_LEN}}
    ip ospf 1 area 0.0.0.0
interface vlan {{ variables.HMN_VLAN }}
    description HMN
    ip mtu 9198
    ip address {{ variables.HMN_IP }}/{{variables.HMN_PREFIX_LEN}}
    ip ospf 1 area 0.0.0.0
interface vlan {{ variables.CMN_VLAN }}
    vrf attach Customer
    description CMN
    ip mtu 9198
    ip address {{ variables.CMN_IP }}/{{variables.CMN_PREFIX_LEN}}
    ip ospf 1 area 0.0.0.0
    
{%- include '1.2/aruba/common/mtn_hmn_vlan.j2' %}
{%- include '1.2/aruba/common/mtn_nmn_vlan.j2' %}

vsx
    system-mac 02:00:00:00:73:00
    inter-switch-link lag 256
    role secondary
    keepalive peer 192.168.255.0 source 192.168.255.1 vrf keepalive
    linkup-delay-timer 600
    vsx-sync vsx-global

router ospf 1 vrf Customer
    router-id {{ variables.LOOPBACK_IP }}
    area 0.0.0.0
router ospf 1
    router-id {{ variables.LOOPBACK_IP }}
    area 0.0.0.0
router ospfv3 1
    router-id {{ variables.LOOPBACK_IP }}
    area 0.0.0.0
https-server vrf Customer
https-server vrf default
https-server vrf mgmt
{# end sw-cdu.secondary #}